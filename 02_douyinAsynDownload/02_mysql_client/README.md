# 1. é¡¹ç›®åŠŸèƒ½

å›½å†…äº‘æœåŠ¡å™¨åŒæ­¥ã€å¤„ç†æŠ–éŸ³è§†é¢‘

1. å°†onedriveä¸­çš„mp4æ–‡ä»¶ååŒæ­¥åˆ°æœ¬åœ°æ•°æ®åº“ä¸­
2. å®šæ—¶æ›´æ–°æœåŠ¡å™¨ä¸­çš„mp4æ–‡ä»¶

# 2. æ–‡ä»¶ç»“æ„

### 1. å®¢æˆ·ç«¯è§†é¢‘å®šæ—¶æ›´æ–°

```
â”œâ”€â”€ 03_mysql_douyin
â”‚Â Â  â”œâ”€â”€ 03_db_config.php                 // è¿æ¥åˆ°æ•°æ®åº“ï¼Œåˆ›å»º $mysql è¿æ¥å¯¹è±¡
â”‚Â Â  â”œâ”€â”€ 03_tk_video_check.php            // å¯¹æ¯”æœåŠ¡å™¨å’Œæ•°æ®åº“ä¸­çš„è§†é¢‘ä¿¡æ¯ï¼Œæ›´æ–°å­˜åœ¨çŠ¶æ€å’Œåˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯
â”‚Â Â  â”œâ”€â”€ 03_copy_remote_to_local.php      // åŸºäºrcloneå°†onedriveä¸­çš„è§†é¢‘ä¿¡æ¯åŒæ­¥åˆ°æœåŠ¡å™¨çš„æ•°æ®åº“ä¸­
â”‚Â Â  â””â”€â”€ 03_random_replace_video.php      // ä»æœåŠ¡å™¨ä¸­åˆ é™¤éƒ¨åˆ†è§†é¢‘ï¼Œä»onedriveä¸­ä¸‹è½½éƒ¨åˆ†è§†é¢‘ï¼Œå®ç°è§†é¢‘æ›´æ–°
```


### 2. å®¢æˆ·ç«¯è§†é¢‘æ’­æ”¾

```php
25_douyinVideo_page.php                        // åˆ†é¡µå±•ç¤ºè§†é¢‘ï¼ŒæŒ‰ç…§æ•°æ®åº“çš„é»˜è®¤é¡ºåºæ˜¾ç¤º

25_douyin_likes_operation.php                  // åŠŸèƒ½æ¨¡å—ï¼Œè·å–æ•°æ®åº“ä¸­æ¯æ¡è§†é¢‘çš„likesæ•°ï¼Œå¯¹likesæ•°è¿›è¡ŒåŠ å‡æ“ä½œ
25_douyinVideo_page_likes_orderDate.php        // åˆ†é¡µå±•ç¤ºè§†é¢‘ï¼ŒæŒ‰ç…§æ•°æ®åº“çš„é»˜è®¤é¡ºåºæ˜¾ç¤ºï¼Œæ”¯æŒå¯¹æ¯æ¡è§†é¢‘çš„likesæ•°è¿›è¡ŒåŠ å‡æ“ä½œï¼Œè°ƒç”¨ 25_douyin_likes_operation.php æ¨¡å—
25_douyinVideo_page_likesOrder.php             // åˆ†é¡µå±•ç¤ºè§†é¢‘ï¼ŒæŒ‰ç…§likesæ•°é™ä½çš„é¡ºåºæ˜¾ç¤ºï¼Œæ”¯æŒå¯¹æ¯æ¡è§†é¢‘çš„likesæ•°è¿›è¡ŒåŠ å‡æ“ä½œï¼Œè°ƒç”¨ 25_douyin_likes_operation.php æ¨¡å—

25_douyinVideo_random.php                      // éšæœºæ’­æ”¾è§†é¢‘
25_douyinVideo_random_preload.php              // éšæœºæ’­æ”¾è§†é¢‘å¹¶é¢„åŠ è½½ä¸‹ä¸€æ¡è§†é¢‘
25_douyinVideo_random_preload_likes.php        // éšæœºæ’­æ”¾likesæ•°å¤§äº0çš„è§†é¢‘å¹¶é¢„åŠ è½½ä¸‹ä¸€æ¡è§†é¢‘
```




# 3. ç¯å¢ƒé…ç½®

## 1. å®¢æˆ·ç«¯è§†é¢‘å®šæ—¶æ›´æ–°

### 1. `03_db_config.php`

1. æ•°æ®åº“

- åˆ›å»ºä¸€ä¸ªmysqlæ•°æ®åº“ tiktok_dbï¼Œè¿™ä¸ªæ•°æ®åº“æœ‰3åˆ—ï¼Œç¬¬ä¸€åˆ—ä¸ºmp4è§†é¢‘åå­— video_nameï¼›ç¬¬ä¸‰åˆ—ä¸ºè§†é¢‘çš„åˆ›å»ºæ—¶é—´ creat_timeï¼›ç¬¬ä¸‰åˆ—ä¸ºè§†é¢‘çš„å­˜åœ¨çŠ¶æ€ exist_statusï¼Œ0ä»£è¡¨ä¸å­˜åœ¨ï¼Œ1ä»£è¡¨å­˜åœ¨ï¼›å¦‚ä¸‹æ‰€ç¤º

```
mysql> describe tk_videos;
+--------------+--------------+------+-----+---------+----------------+
| Field        | Type         | Null | Key | Default | Extra          |
+--------------+--------------+------+-----+---------+----------------+
| id           | int          | NO   | PRI | NULL    | auto_increment |
| video_name   | varchar(255) | NO   |     | NULL    |                |
| create_time  | datetime     | NO   |     | NULL    |                |
| exist_status | tinyint      | NO   |     | NULL    |                |
| likes        | int unsigned | NO   |     | 0       |                |
+--------------+--------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)
```

2. ç¯å¢ƒå˜é‡

```php
$host = 'localhost'; // é€šå¸¸æ˜¯ 'localhost' æˆ–ä¸€ä¸ªIPåœ°å€
$username = 'root'; // æ•°æ®åº“ç”¨æˆ·å
$password = '123456'; // æ•°æ®åº“å¯†ç 
$dbname = 'tiktok_db'; // æ•°æ®åº“åç§°
```

3. å¯¼å‡º/å¤‡ä»½æ•°æ®åº“æ–‡ä»¶å‘½ä»¤

```sh
alias sbt='mysqldump -p tiktok_db > /home/01_html/backup_tiktok_db_$(date +%Y%m%d_%H%M%S).sql'
```



### 2. `03_tk_video_check.php`

ğŸŸ¢ åŒæ­¥æœ¬åœ°è§†é¢‘æ–‡ä»¶å’Œæ•°æ®åº“è®°å½•ï¼Œé€šè¿‡æ£€æŸ¥ã€æ›´æ–°å’Œç»Ÿè®¡æœ¬åœ°è§†é¢‘æ–‡ä»¶çš„å­˜åœ¨çŠ¶æ€å’Œæ•°æ®åº“ä¸­çš„ç›¸åº”è®°å½•

1. åŠŸèƒ½

- æ£€æŸ¥å’Œæ‰“å¼€ç›®å½•ï¼šéªŒè¯æŒ‡å®šç›®å½•ï¼ˆå­˜æ”¾è§†é¢‘æ–‡ä»¶ï¼‰æ˜¯å¦å­˜åœ¨å¹¶å¯è¯»ï¼Œç„¶åæ‰“å¼€è¿™ä¸ªç›®å½•ã€‚
- éå†ç›®å½•ä¸­çš„è§†é¢‘æ–‡ä»¶ï¼šéå†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¯¹äºæ¯ä¸ª .mp4 è§†é¢‘æ–‡ä»¶ï¼Œæ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨è¯¥è§†é¢‘æ–‡ä»¶çš„è®°å½•ã€‚
- æ•°æ®åº“æ“ä½œï¼š
  - å¦‚æœè§†é¢‘æ–‡ä»¶åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œå°†å…¶ä¿¡æ¯ï¼ˆæ–‡ä»¶åå’Œåˆ›å»ºæ—¶é—´ï¼‰æ’å…¥æ•°æ®åº“ï¼Œå¹¶è®¾ç½®å…¶å­˜åœ¨çŠ¶æ€ä¸º 1ã€‚
  - éå†æ•°æ®åº“ä¸­çš„è§†é¢‘è®°å½•ï¼Œæ£€æŸ¥æ¯ä¸ªè§†é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºæœ¬åœ°ç›®å½•ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ä½†æ•°æ®åº“æ ‡è®°ä¸ºä¸å­˜åœ¨ï¼ˆexist_status = 0ï¼‰ï¼Œåˆ™æ›´æ–°çŠ¶æ€ä¸ºå­˜åœ¨ï¼ˆexist_status = 1ï¼‰å¹¶æ›´æ–°åˆ›å»ºæ—¶é—´ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ›´æ–°çŠ¶æ€ä¸ºä¸å­˜åœ¨ï¼ˆexist_status = 0ï¼‰ã€‚
  - ç»Ÿè®¡å’Œæ‰“å°ä¿¡æ¯ï¼šè®¡ç®—å¹¶æ‰“å°æ•°æ®åº“ä¸­æ‰€æœ‰è§†é¢‘çš„æ€»æ•°ï¼Œä»¥åŠå­˜åœ¨çŠ¶æ€ä¸º 1 å’Œ 0 çš„è§†é¢‘æ•°é‡ã€‚
- å…³é—­æ•°æ®åº“è¿æ¥ï¼šåœ¨æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥ã€‚

2. ç¯å¢ƒå˜é‡

```php
// å¼•å…¥æ•°æ®åº“é…ç½®å’Œè¿æ¥
include '03_db_config.php';

// æŒ‡å®šè§†é¢‘æ–‡ä»¶æ‰€åœ¨ç›®å½•
$video_dir = "/home/01_html/01_tecent1017/25_film_videos";
```

### 3. `03_copy_remote_to_local.php`

ğŸŸ¢ è¿™æ®µä»£ç ä½¿ç”¨ rclone ä»è¿œç¨‹ç›®å½•è·å– `.mp4` æ ¼å¼çš„è§†é¢‘æ–‡ä»¶åï¼Œæ£€æŸ¥æ•°æ®åº“ä¸­çš„è®°å½•ï¼Œå¹¶ä¸ºæ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„è§†é¢‘æ–‡ä»¶æ’å…¥æ–°è®°å½•ã€‚

1. åŠŸèƒ½

- ä½¿ç”¨ rclone è·å–è¿œç¨‹ç›®å½•çš„è§†é¢‘æ–‡ä»¶ï¼šé€šè¿‡ rclone å‘½ä»¤è·å–è¿œç¨‹ç›®å½•ä¸­æ‰€æœ‰ .mp4 æ ¼å¼çš„è§†é¢‘æ–‡ä»¶åã€‚
- æ•°æ®åº“æ“ä½œï¼š
  - éå†è·å–åˆ°çš„è§†é¢‘æ–‡ä»¶åï¼Œæ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨è¿™äº›è§†é¢‘æ–‡ä»¶çš„è®°å½•ã€‚
  - å¦‚æœè§†é¢‘æ–‡ä»¶åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶æ’å…¥æ•°æ®åº“ï¼Œå¹¶è®¾ç½®å…¶åˆ›å»ºæ—¶é—´ä¸ºå½“å‰æ—¶é—´ï¼Œå­˜åœ¨çŠ¶æ€ä¸º 0ã€‚
  - æ–‡ä»¶å¤åˆ¶ï¼šä»£ç ä¸­æœ‰æ³¨é‡Šæ‰çš„éƒ¨åˆ†ï¼Œæœ¬æ„æ˜¯ä½¿ç”¨ rclone å¤åˆ¶ä¸å­˜åœ¨äºæ•°æ®åº“ä¸­çš„è§†é¢‘æ–‡ä»¶åˆ°æœ¬åœ°ç›®å½•ï¼Œä½†è¿™éƒ¨åˆ†ä»£ç åœ¨å®é™…è¿è¡Œä¸­è¢«æ³¨é‡Šæ‰äº†ã€‚
- ç»Ÿè®¡å’Œæ‰“å°ä¿¡æ¯ï¼šè®¡ç®—å¹¶æ‰“å°å‡ºæ–°æ’å…¥æ•°æ®åº“çš„è§†é¢‘æ–‡ä»¶æ•°é‡ã€‚
- å…³é—­æ•°æ®åº“è¿æ¥ï¼šåœ¨æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥ã€‚

2. ç¯å¢ƒå˜é‡

```php
// å¼•å…¥æ•°æ®åº“é…ç½®å’Œè¿æ¥
include '03_db_config.php';

// è¿œç¨‹ç›®å½•
$remote_dir = "HW-1012:do1-2/01_html/02_douyVideo";
// æœ¬åœ°ç›®å½•
$local_dir = "/home/01_html/01_tecent1017/25_film_videos";
```


### 4. `03_random_replace_video.php`

ğŸŸ¢ è¿™æ®µä»£ç ä¸»è¦å®ç°äº†ä»æœ¬åœ°åˆ é™¤éšæœºé€‰å®šçš„è§†é¢‘æ–‡ä»¶ï¼Œå¹¶ä»è¿œç¨‹ç›®å½•å¤åˆ¶æ•°æ®åº“ä¸­è®°å½•çš„ä½†æœ¬åœ°ç¼ºå¤±çš„è§†é¢‘æ–‡ä»¶åˆ°æœ¬åœ°ã€‚

1. åŠŸèƒ½

- å¼•å…¥æ•°æ®åº“é…ç½®å¹¶è¿æ¥æ•°æ®åº“ã€‚
- æ‰§è¡Œä¸€ä¸ª PHP è„šæœ¬ä»¥æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼ˆ`03_copy_remote_to_local.php`ï¼‰ã€‚
- å®šä¹‰æœ¬åœ°å’Œè¿œç¨‹ç›®å½•ï¼Œç”¨äºå­˜å‚¨å’Œæ“ä½œè§†é¢‘æ–‡ä»¶ã€‚
- ä»æœ¬åœ°ç›®å½•è¯»å–æ‰€æœ‰ MP4 è§†é¢‘æ–‡ä»¶åï¼Œå¹¶å­˜å…¥æ•°ç»„ Aã€‚
- ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ‰€æœ‰è§†é¢‘æ–‡ä»¶åï¼Œå¹¶å­˜å…¥æ•°ç»„ Bã€‚
- ä»æ•°ç»„ A ä¸­éšæœºé€‰å– Nï¼ˆé»˜è®¤ä¸º 50ï¼‰ä¸ªè§†é¢‘ï¼Œå¹¶ä»æœ¬åœ°ç›®å½•åˆ é™¤è¿™äº›è§†é¢‘ã€‚
- è®¡ç®—æ•°ç»„ B å’Œ A çš„å·®é›†ï¼ˆå³å­˜åœ¨äº B ä¸­ä½†ä¸åœ¨ A ä¸­çš„è§†é¢‘ï¼‰ï¼Œç„¶åä»è¿™ä¸ªå·®é›†ä¸­éšæœºé€‰å– Mï¼ˆé»˜è®¤ä¸º 50ï¼‰ä¸ªè§†é¢‘ã€‚
- å°†è¿™ M ä¸ªè§†é¢‘ä»è¿œç¨‹ç›®å½•å¤åˆ¶åˆ°æœ¬åœ°ç›®å½•ã€‚
- å…³é—­æ•°æ®åº“è¿æ¥ã€‚
- æ‰§è¡Œå¦ä¸€ä¸ª PHP è„šæœ¬è¿›è¡Œç‰¹å®šçš„åç»­æ£€æŸ¥ï¼ˆ`03_tk_video_check.php`ï¼‰ã€‚
- è¾“å‡ºæ•´ä¸ªè¿‡ç¨‹å®Œæˆçš„ä¿¡æ¯ã€‚

2. ç¯å¢ƒå˜é‡

```php
// å¼•å…¥æ•°æ®åº“é…ç½®å’Œè¿æ¥
include '03_db_config.php'; // æ ¹æ®å®é™…è·¯å¾„è°ƒæ•´

exec('php /home/01_html/03_mysql_douyin/03_copy_remote_to_local.php');

// å®šä¹‰æœ¬åœ°å’Œè¿œç¨‹ç›®å½•
$local_dir = "/home/01_html/01_tecent1017/25_film_videos";
$remote_dir = "HW-1012:do1-2/01_html/02_douyVideo";

exec('php /home/01_html/03_mysql_douyin/03_tk_video_check.php');
```

3. å®šæ—¶ä»»åŠ¡

æ¯å°æ—¶çš„ç¬¬ 30 åˆ†é’Ÿ æ‰§è¡Œä¸€æ¬¡ PHP è„šæœ¬

```bash
30 * * * * /usr/bin/php /home/01_html/03_mysql_douyin/03_random_replace_video.php
```


## 2. å®¢æˆ·ç«¯è§†é¢‘æ’­æ”¾


### 1. 25_douyinVideo_page.php

1. åŠŸèƒ½

åˆ†é¡µå±•ç¤ºè§†é¢‘ï¼ŒæŒ‰ç…§æ•°æ®åº“çš„é»˜è®¤é¡ºåºæ˜¾ç¤º


2. ç¯å¢ƒå˜é‡

```php
    $domain = 'http://domain.com';                       // æ›¿æ¢æˆå¯¹åº”ipæˆ–è€…åŸŸå
    $videoPath = '/home/01_html/03_douyVideoLocal/';     // å­˜æ”¾è§†é¢‘çš„è·¯å¾„

    $videosPerRow = 2;                                   // æ¯è¡Œæ˜¾ç¤ºçš„è§†é¢‘æ•°
    $videosPerPage = 60;                                 // æ¯é¡µæ˜¾ç¤ºçš„è§†é¢‘æ•°

    // æ„é€ è§†é¢‘æ’­æ”¾é“¾æ¥
    $videoUrl = $domain . '/03_douyVideoLocal/' . $videoName;
```


### 2. 25_douyin_likes_operation.php  åŠŸèƒ½æ¨¡å—

1. åŠŸèƒ½

åŠŸèƒ½æ¨¡å—ï¼Œè·å–æ•°æ®åº“ä¸­æ¯æ¡è§†é¢‘çš„likesæ•°ï¼Œå¯¹likesæ•°è¿›è¡ŒåŠ å‡æ“ä½œ


2. ç¯å¢ƒå˜é‡

```php
// å¼•å…¥æ•°æ®åº“é…ç½®æ–‡ä»¶
require_once '/home/01_html/03_mysql_douyin/03_db_config.php';

// æ›´æ–°æˆåŠŸåï¼Œè·å–æœ€æ–°çš„ likes å€¼
$select_stmt = $mysqli->prepare("SELECT likes FROM tk_videos WHERE video_name = ?");
```


### 3. 25_douyinVideo_page_likes_orderDate.php

1. åŠŸèƒ½

åˆ†é¡µå±•ç¤ºè§†é¢‘ï¼ŒæŒ‰ç…§æ•°æ®åº“çš„é»˜è®¤é¡ºåºæ˜¾ç¤ºï¼Œæ”¯æŒå¯¹æ¯æ¡è§†é¢‘çš„likesæ•°è¿›è¡ŒåŠ å‡æ“ä½œï¼Œè°ƒç”¨ `25_douyin_likes_operation.php` æ¨¡å—


2. ç¯å¢ƒå˜é‡

```php

```



### 4. 25_douyinVideo_page_likesOrder.php

1. åŠŸèƒ½

åˆ†é¡µå±•ç¤ºè§†é¢‘ï¼ŒæŒ‰ç…§likesæ•°é™ä½çš„é¡ºåºæ˜¾ç¤ºï¼Œæ”¯æŒå¯¹æ¯æ¡è§†é¢‘çš„likesæ•°è¿›è¡ŒåŠ å‡æ“ä½œï¼Œè°ƒç”¨ `25_douyin_likes_operation.php` æ¨¡å—


2. ç¯å¢ƒå˜é‡

```php

```



### 5. 25_douyinVideo_random.php

1. åŠŸèƒ½

éšæœºæ’­æ”¾è§†é¢‘


2. ç¯å¢ƒå˜é‡

```php

```


### 6. 25_douyinVideo_random_preload.php

1. åŠŸèƒ½

éšæœºæ’­æ”¾è§†é¢‘å¹¶é¢„åŠ è½½ä¸‹ä¸€æ¡è§†é¢‘


2. ç¯å¢ƒå˜é‡

```php

```



### 7. 25_douyinVideo_random_preload_likes.php

1. åŠŸèƒ½

éšæœºæ’­æ”¾likesæ•°å¤§äº0çš„è§†é¢‘å¹¶é¢„åŠ è½½ä¸‹ä¸€æ¡è§†é¢‘



2. ç¯å¢ƒå˜é‡

```php

```





# å‚è€ƒèµ„æ–™

1. [MySQLå®‰è£…åŠæ•°æ®è¿ç§»](https://github.com/Yiwei666/12_blog/blob/main/002/002.md)






